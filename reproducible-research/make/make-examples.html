

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Learn “Make” by Examples &#8212; Music</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.5ea377869091fd0449014c60fc090103.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-dropdown.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/book-stylesheet.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-167881009-1"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'UA-167881009-1');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'reproducible-research/make/make-examples';</script>
    <script src="../../_static/script.js"></script>
    <link rel="canonical" href="https://book.the-turing-way.org/reproducible-research/make/make-examples.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content"><a href='https://www.gutenberg.org/files/174/174-h/174-h.htm'>Aesthetics vs. Morality</a></div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="https://static.dw.com/image/62054308_1004.webp" class="logo__image only-light" alt="Music - Home"/>
    <script>document.write(`<img src="https://static.dw.com/image/62054308_1004.webp" class="logo__image only-dark" alt="Music - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    Continuous 1, 2, 3
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../foreword/foreword.html">Foreword</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../foreword/background.html">Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../foreword/navigate.html">Navigating the Handbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../foreword/emergent-strategy.html">Emergence as The Turing Way Strategy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../foreword/embracing-digital-commons.html">Embracing the Principles of Digital Commons</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../foreword/community.html">Community and Community Roles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../foreword/governance.html">Governance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../foreword/cite.html">How to Cite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../foreword/faqs.html">Frequently Asked Questions</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../reproducible-research.html">Guide for Reproducible Research</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../overview.html">Overview</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../overview/overview-definitions.html">Definitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../overview/overview-benefit.html">Added Advantages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../overview/overview-barriers.html">Barriers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../overview/overview-resources.html">Resources</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../open.html">Open Research</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../open/open-data.html">Open Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../open/open-source.html">Open Source Software</a></li>
<li class="toctree-l3"><a class="reference internal" href="../open/open-hardware.html">Open Source Hardware</a></li>




<li class="toctree-l3"><a class="reference internal" href="../open/open-access.html">Open Access</a></li>
<li class="toctree-l3"><a class="reference internal" href="../open/open-notebooks.html">Open Notebooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../open/open-scholarship.html">Open Scholarship</a></li>
<li class="toctree-l3"><a class="reference internal" href="../open/open-checklist.html">Checklist</a></li>
<li class="toctree-l3"><a class="reference internal" href="../open/open-resources.html">Resources</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../vcs.html">Version Control</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../vcs/vcs-workflow.html">Version Control Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vcs/vcs-workflow-branches.html">Version Control and Branches</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vcs/vcs-git-general.html">The Git Version Control Software</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vcs/vcs-git-in-research.html">Git for Research Projects</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../vcs/vcs-git.html">Git Using the Command Line</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../vcs/vcs-git-commit.html">Git Commit Command</a></li>
<li class="toctree-l4"><a class="reference internal" href="../vcs/vcs-git-compare.html">Retrieving and Comparing Versions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../vcs/vcs-git-branches.html">Git Branches</a></li>
<li class="toctree-l4"><a class="reference internal" href="../vcs/vcs-git-merge.html">Merging Branches in Git</a></li>
<li class="toctree-l4"><a class="reference internal" href="../vcs/vcs-git-interactive.html">Interactive, Visual Git</a></li>
<li class="toctree-l4"><a class="reference internal" href="../vcs/vcs-github.html">Git Commands to Work on GitHub</a></li>
<li class="toctree-l4"><a class="reference internal" href="../vcs/vcs-git-summary.html">Summary Table of Git Commands</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../vcs/vcs-data.html">Version Control for Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vcs/vcs-personal-stories.html">Personal Stories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vcs/vcs-checklist.html">Checklist</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vcs/vcs-resources.html">Resources</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../licensing.html">Licensing</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../licensing/licensing-compatibility.html">License Compatibililty</a></li>
<li class="toctree-l3"><a class="reference internal" href="../licensing/licensing-ethical-source.html">Ethics-informed Licensing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../licensing/licensing-data.html">Data Licenses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../licensing/licensing-hardware.html">Hardware Licenses</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../licensing/licensing-ml.html">Machine Learning Model Licenses</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../licensing/licensing-ml-case-studies.html">Case Studies: Choosing an ML License</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../licensing/licensing-checklist.html">Checklist</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../rdm.html">Research Data Management</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../rdm/rdm-data.html">Research Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rdm/rdm-find.html">Finding Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rdm/rdm-dmp.html">Data Management Plan</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rdm/rdm-fair.html">The FAIR Principles and Practices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rdm/rdm-personal.html">Personal data management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rdm/rdm-storage.html">Data Storage and Organisation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rdm/rdm-spreadsheets.html">Data Organisation in Spreadsheets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rdm/rdm-metadata.html">Documentation and Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rdm/rdm-methods.html">Methods and Protocols</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rdm/rdm-elns.html">Electronic Lab Notebooks (ELNs)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rdm/rdm-data-curation.html">Data Curation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rdm/rdm-visualisation.html">Data Visualisation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rdm/rdm-repository.html">Data Repositories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rdm/rdm-sharing.html">Sharing and Archiving Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rdm/rdm-article.html">Data Article</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rdm/rdm-checklist.html">Checklist</a></li>


<li class="toctree-l3"><a class="reference internal" href="../rdm/rdm-stories.html">Personal Impact Stories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rdm/rdm-resources.html">Resources</a></li>

</ul>
</details></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/the-turing-way/the-turing-way" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/the-turing-way/the-turing-way/edit/main/book/website/reproducible-research/make/make-examples.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/the-turing-way/the-turing-way/issues/new?title=Issue%20on%20page%20%2Freproducible-research/make/make-examples.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/reproducible-research/make/make-examples.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Learn “Make” by Examples</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#makefiles">Makefiles</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up">Setting up</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#makefile-no-1-the-basics">Makefile no. 1 (The Basics)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#makefile-no-2-all-and-clean">Makefile no. 2 (all and clean)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#makefile-no-3-phony-targets">Makefile no. 3 (Phony Targets)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#makefile-no-4-automatic-variables-and-pattern-rules">Makefile no. 4 (Automatic Variables and Pattern Rules)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#automatic-variables">Automatic Variables.</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pattern-rules">Pattern Rules</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#makefile-no-5-wildcards-and-path-substitution">Makefile no. 5 (Wildcards and Path Substitution)</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="learn-make-by-examples">
<span id="rr-make-examples-learnmake"></span><h1>Learn “Make” by Examples<a class="headerlink" href="#learn-make-by-examples" title="Permalink to this heading">#</a></h1>
<section id="makefiles">
<span id="rr-make-examples-makefiles"></span><h2>Makefiles<a class="headerlink" href="#makefiles" title="Permalink to this heading">#</a></h2>
<p>One of the things that might discourage someone from using Make is that
existing Makefiles can look quite complex, and it might seem difficult to
tailor one to your own needs. In this hands-on tutorial we will create a
Makefile from scratch for a real data analysis project. The idea is to explain
different features of Make by iterating through several versions of a Makefile
for this project. Hopefully the experience that you gain from this tutorial
allows you to create Makefiles for your own projects.</p>
<p>We will create a <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> for a data analysis pipeline. The task is as
follows:</p>
<blockquote>
<div><p><strong>Task: Given some datasets, create a summary report (in pdf) that contains
the histograms of these datasets.</strong></p>
</div></blockquote>
<p>(Of course this data task is very simple to focus on how to use Make.)</p>
<p><em>Throughout the tutorial code blocks that start with a dollar sign (<code class="docutils literal notranslate"><span class="pre">$</span></code>) are
intended to be typed in the terminal.</em></p>
<section id="setting-up">
<span id="rr-make-examples-settingup"></span><h3>Setting up<a class="headerlink" href="#setting-up" title="Permalink to this heading">#</a></h3>
<p>We have created a basic repository for this task, that already contains
everything that we need (<em>except the Makefile of course!</em>). To start, clone
the base repository using git:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/alan-turing-institute/IntroToMake
</pre></div>
</div>
<p>This basic repository contains all the code that we’ll need in this tutorial,
and should have this content:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>.
├── data/
│   ├── input_file_1.csv
│   └── input_file_2.csv
├── LICENSE
├── output/
├── README.md
├── report/
│   └── report.tex
└── scripts/
    └── generate_histogram.py
</pre></div>
</div>
<ul class="simple">
<li><p><strong>data</strong>: directory with two datasets that we’re going to analyse</p></li>
<li><p><strong>report</strong>: the input directory for the report</p></li>
<li><p><strong>scripts</strong>: directory for the analysis script</p></li>
<li><p><strong>output</strong>: output directory for the figures and the report</p></li>
</ul>
<p>You’ll notice that there are two datasets in the <strong>data</strong> directory
(<code class="docutils literal notranslate"><span class="pre">input_file_1.csv</span></code> and <code class="docutils literal notranslate"><span class="pre">input_file_2.csv</span></code>) and that there is already a
basic Python script in <strong>scripts</strong> and a basic report LaTeX file in
<strong>report</strong>.</p>
<p>If you want to follow along, ensure that you have the <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> and
<code class="docutils literal notranslate"><span class="pre">numpy</span></code> packages installed:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>matplotlib<span class="w"> </span>numpy
</pre></div>
</div>
<p>You will also need a working version of <code class="docutils literal notranslate"><span class="pre">pdflatex</span></code> and, of course, <code class="docutils literal notranslate"><span class="pre">make</span></code>.</p>
<p>For installation instructions for Make, see <a class="reference internal" href="make-appendix.html#rr-make-appendix-installing"><span class="std std-ref">Installing Make</span></a>.</p>
</section>
<section id="makefile-no-1-the-basics">
<span id="rr-make-examples-makefile1"></span><h3>Makefile no. 1 (The Basics)<a class="headerlink" href="#makefile-no-1-the-basics" title="Permalink to this heading">#</a></h3>
<p>Let’s create our first Makefile. In the terminal, move into the
<code class="docutils literal notranslate"><span class="pre">IntroToMake</span></code> repository that you just cloned:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>IntroToMake
</pre></div>
</div>
<p>Using your favourite editor, create a file called <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> with the
following contents:</p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="c"># Makefile for analysis report</span>

<span class="nf">output/figure_1.png</span><span class="o">:</span><span class="w"> </span><span class="n">data</span>/<span class="n">input_file_</span>1.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_histogram</span>.<span class="n">py</span>
<span class="w">	</span>python<span class="w"> </span>scripts/generate_histogram.py<span class="w"> </span>-i<span class="w"> </span>data/input_file_1.csv<span class="w"> </span>-o<span class="w"> </span>output/figure_1.png

<span class="nf">output/figure_2.png</span><span class="o">:</span><span class="w"> </span><span class="n">data</span>/<span class="n">input_file_</span>2.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_histogram</span>.<span class="n">py</span>
<span class="w">	</span>python<span class="w"> </span>scripts/generate_histogram.py<span class="w"> </span>-i<span class="w"> </span>data/input_file_2.csv<span class="w"> </span>-o<span class="w"> </span>output/figure_2.png

<span class="nf">output/report.pdf</span><span class="o">:</span><span class="w"> </span><span class="n">report</span>/<span class="n">report</span>.<span class="n">tex</span> <span class="n">output</span>/<span class="n">figure_</span>1.<span class="n">png</span> <span class="n">output</span>/<span class="n">figure_</span>2.<span class="n">png</span>
<span class="w">	</span><span class="nb">cd</span><span class="w"> </span>report/<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>pdflatex<span class="w"> </span>report.tex<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mv<span class="w"> </span>report.pdf<span class="w"> </span>../output/report.pdf
</pre></div>
</div>
<p>The indentation in each of the recipes are <em><strong>tabs</strong></em>, Makefiles do not accept
indentation with spaces.</p>
<p>You should now be able to type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>make<span class="w"> </span>output/report.pdf
</pre></div>
</div>
<p>If everything worked correctly, the two figures will be created and pdf report
will be built.</p>
<p>Let’s go through the Makefile in a bit more detail. We have three rules, two
for the figures and one for the report. Let’s look at the rule for
<code class="docutils literal notranslate"><span class="pre">output/figure_1.png</span></code> first. This rule has the target
<code class="docutils literal notranslate"><span class="pre">output/figure_1.png</span></code> that has two prerequisites: <code class="docutils literal notranslate"><span class="pre">data/input_file_1.csv</span></code>
and <code class="docutils literal notranslate"><span class="pre">scripts/generate_histogram.py</span></code>. By giving the output file these
prerequisites it will be updated if either of these files changes. This is one
of the reasons why Make was created: to update output files when source files
change.</p>
<p>You’ll notice that the recipe line calls Python with the script name and uses
command line flags (<code class="docutils literal notranslate"><span class="pre">-i</span></code> and <code class="docutils literal notranslate"><span class="pre">-o</span></code>) to mark the input and output of the
script. This isn’t a requirement for using Make, but it makes it easy to see
which file is an input to the script and which is an output.</p>
<p>The rule for the PDF report is very similar, but it has three prerequisites
(the LaTeX source and both figures). Notice that the recipe changes the
working directory before calling LaTeX and also moves the generated PDF to the
output directory. We’re doing this to keep the LaTeX intermediate files in the
report directory. However, it’s important to distinguish the above rule from
the following:</p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="c"># don&#39;t do this</span>
<span class="nf">output/report.pdf</span><span class="o">:</span><span class="w"> </span><span class="n">report</span>/<span class="n">report</span>.<span class="n">tex</span> <span class="n">output</span>/<span class="n">figure_</span>1.<span class="n">png</span> <span class="n">output</span>/<span class="n">figure_</span>2.<span class="n">png</span>
<span class="w">	</span><span class="nb">cd</span><span class="w"> </span>report/
<span class="w">	</span>pdflatex<span class="w"> </span>report.tex
<span class="w">	</span>mv<span class="w"> </span>report.pdf<span class="w"> </span>../output/report.pdf
</pre></div>
</div>
<p>This rule places the three commands on separate lines. However, <strong>Make
executes each line independently</strong> in a separate subshell, so changing the
working directory in the first line has no effect on the second, and a failure
in the second line won’t stop the third line from being executed. Therefore,
we combine the three commands in a single recipe above.</p>
<p>This is what the dependency tree looks like for this Makefile:</p>
<p><img alt="DAG for Makefile no. 1" src="figures/makefile-no1.png" />
<small style="margin: 5pt auto; text-align: center; display: block;">The
dependency graph for our first Makefile, created using
<a class="reference external" href="https://github.com/lindenb/makefile2graph">makefile2graph</a>. Notice the
similarity to the figure <a class="reference internal" href="../make.html#rr-make-summary"><span class="std std-ref">in the introduction</span></a>!</small></p>
</section>
<section id="makefile-no-2-all-and-clean">
<span id="rr-make-examples-makefile2"></span><h3>Makefile no. 2 (all and clean)<a class="headerlink" href="#makefile-no-2-all-and-clean" title="Permalink to this heading">#</a></h3>
<p>In our first Makefile we have the basic rules in place. We could stick with
this if we wanted to, but there are a few improvements we can make:</p>
<ol class="arabic simple">
<li><p>We now have to explicitly call <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">output/report.pdf</span></code> if we want to
make the report.</p></li>
<li><p>We have no way to clean up and start fresh.</p></li>
</ol>
<p>Let’s remedy this by adding two new targets: <code class="docutils literal notranslate"><span class="pre">all</span></code> and <code class="docutils literal notranslate"><span class="pre">clean</span></code>. In your
editor, change the Makefile contents to add the <code class="docutils literal notranslate"><span class="pre">all</span></code> and <code class="docutils literal notranslate"><span class="pre">clean</span></code> rules as
follows:</p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="c"># Makefile for analysis report</span>

<span class="nf">all</span><span class="o">:</span><span class="w"> </span><span class="n">output</span>/<span class="n">report</span>.<span class="n">pdf</span>

<span class="nf">output/figure_1.png</span><span class="o">:</span><span class="w"> </span><span class="n">data</span>/<span class="n">input_file_</span>1.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_histogram</span>.<span class="n">py</span>
<span class="w">	</span>python<span class="w"> </span>scripts/generate_histogram.py<span class="w"> </span>-i<span class="w"> </span>data/input_file_1.csv<span class="w"> </span>-o<span class="w"> </span>output/figure_1.png

<span class="nf">output/figure_2.png</span><span class="o">:</span><span class="w"> </span><span class="n">data</span>/<span class="n">input_file_</span>2.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_histogram</span>.<span class="n">py</span>
<span class="w">	</span>python<span class="w"> </span>scripts/generate_histogram.py<span class="w"> </span>-i<span class="w"> </span>data/input_file_2.csv<span class="w"> </span>-o<span class="w"> </span>output/figure_2.png

<span class="nf">output/report.pdf</span><span class="o">:</span><span class="w"> </span><span class="n">report</span>/<span class="n">report</span>.<span class="n">tex</span> <span class="n">output</span>/<span class="n">figure_</span>1.<span class="n">png</span> <span class="n">output</span>/<span class="n">figure_</span>2.<span class="n">png</span>
<span class="w">	</span><span class="nb">cd</span><span class="w"> </span>report/<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>pdflatex<span class="w"> </span>report.tex<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mv<span class="w"> </span>report.pdf<span class="w"> </span>../output/report.pdf

<span class="nf">clean</span><span class="o">:</span>
<span class="w">	</span>rm<span class="w"> </span>-f<span class="w"> </span>output/report.pdf
<span class="w">	</span>rm<span class="w"> </span>-f<span class="w"> </span>output/figure_*.png
</pre></div>
</div>
<p>Note that we’ve added the <code class="docutils literal notranslate"><span class="pre">all</span></code> target to the top of the file. We do this
because Make executes the <em>first</em> target when no explicit target is given.  So
you can now type <code class="docutils literal notranslate"><span class="pre">make</span></code> on the command line and it would do the same as
<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span></code>.  Also, note that we’ve only added the report as the prerequisite
of <code class="docutils literal notranslate"><span class="pre">all</span></code> because that’s our desired output and the other rules help to build
that output. If you have multiple outputs, you could add these as further
prerequisites to the <code class="docutils literal notranslate"><span class="pre">all</span></code> target. Calling the main target <code class="docutils literal notranslate"><span class="pre">all</span></code> is a
convention of Makefiles that many people follow.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">clean</span></code> rule is typically at the bottom, but that’s more style than
requirement. Note that we use the <code class="docutils literal notranslate"><span class="pre">-f</span></code> flag to <code class="docutils literal notranslate"><span class="pre">rm</span></code> to make sure it
doesn’t complain when there is no file to remove.</p>
<p>You can try out the new Makefile by running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>make<span class="w"> </span>clean
$<span class="w"> </span>make
</pre></div>
</div>
<p>Make should remove the output and intermediate files after the first command,
and generate them again after the second.</p>
</section>
<section id="makefile-no-3-phony-targets">
<span id="rr-make-examples-makefile3"></span><h3>Makefile no. 3 (Phony Targets)<a class="headerlink" href="#makefile-no-3-phony-targets" title="Permalink to this heading">#</a></h3>
<p>Typically, <code class="docutils literal notranslate"><span class="pre">all</span></code> and <code class="docutils literal notranslate"><span class="pre">clean</span></code> are defined as so-called <a class="reference external" href="https://www.gnu.org/software/make/manual/make.html#Phony-Targets">Phony
Targets</a>.
These are targets that don’t actually create an output file. If not marked as <code class="docutils literal notranslate"><span class="pre">.PHONY</span></code> these targets would
always be run if they come up in a dependency, but will no longer be run if a
directory/file is ever created that is called <code class="docutils literal notranslate"><span class="pre">all</span></code> or <code class="docutils literal notranslate"><span class="pre">clean</span></code>. We
therefore add a line at the top of the Makefile to define these two as phony
targets:</p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="c"># Makefile for analysis report</span>

<span class="nf">.PHONY</span><span class="o">:</span><span class="w"> </span><span class="n">all</span> <span class="n">clean</span>

<span class="nf">all</span><span class="o">:</span><span class="w"> </span><span class="n">output</span>/<span class="n">report</span>.<span class="n">pdf</span>

<span class="nf">output/figure_1.png</span><span class="o">:</span><span class="w"> </span><span class="n">data</span>/<span class="n">input_file_</span>1.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_histogram</span>.<span class="n">py</span>
<span class="w">	</span>python<span class="w"> </span>scripts/generate_histogram.py<span class="w"> </span>-i<span class="w"> </span>data/input_file_1.csv<span class="w"> </span>-o<span class="w"> </span>output/figure_1.png

<span class="nf">output/figure_2.png</span><span class="o">:</span><span class="w"> </span><span class="n">data</span>/<span class="n">input_file_</span>2.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_histogram</span>.<span class="n">py</span>
<span class="w">	</span>python<span class="w"> </span>scripts/generate_histogram.py<span class="w"> </span>-i<span class="w"> </span>data/input_file_2.csv<span class="w"> </span>-o<span class="w"> </span>output/figure_2.png

<span class="nf">output/report.pdf</span><span class="o">:</span><span class="w"> </span><span class="n">report</span>/<span class="n">report</span>.<span class="n">tex</span> <span class="n">output</span>/<span class="n">figure_</span>1.<span class="n">png</span> <span class="n">output</span>/<span class="n">figure_</span>2.<span class="n">png</span>
<span class="w">	</span><span class="nb">cd</span><span class="w"> </span>report/<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>pdflatex<span class="w"> </span>report.tex<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mv<span class="w"> </span>report.pdf<span class="w"> </span>../output/report.pdf

<span class="nf">clean</span><span class="o">:</span>
<span class="w">	</span>rm<span class="w"> </span>-f<span class="w"> </span>output/report.pdf
<span class="w">	</span>rm<span class="w"> </span>-f<span class="w"> </span>output/figure_*.png
</pre></div>
</div>
<p>Phony targets are also useful when you want to use Make recursively. In that
case you would specify the subdirectories as phony targets. You can read more
about <a class="reference external" href="https://www.gnu.org/software/make/manual/make.html#Phony-Targets">phony targets in the
documentation</a>,
but for now it’s enough to know that <code class="docutils literal notranslate"><span class="pre">all</span></code> and <code class="docutils literal notranslate"><span class="pre">clean</span></code> are typically
declared as phony.</p>
<blockquote>
<div><p>Sidenote: another target that’s typically phony is <strong>test</strong>, in case you
have a directory of tests called <strong>test</strong> and want to have a target to run
them that’s also called <strong>test</strong>.</p>
</div></blockquote>
</section>
<section id="makefile-no-4-automatic-variables-and-pattern-rules">
<span id="rr-make-examples-makefile4"></span><h3>Makefile no. 4 (Automatic Variables and Pattern Rules)<a class="headerlink" href="#makefile-no-4-automatic-variables-and-pattern-rules" title="Permalink to this heading">#</a></h3>
<p>There’s nothing wrong with the Makefile we have now, but it’s somewhat verbose
because we’ve declared all the targets explicitly using separate rules. We can
simplify this by using <a class="reference external" href="https://www.gnu.org/software/make/manual/html_node/Automatic-Variables.html">Automatic
Variables</a>
and <a class="reference external" href="https://www.gnu.org/software/make/manual/html_node/Pattern-Rules.html#Pattern-Rules">Pattern
Rules</a>.</p>
<section id="automatic-variables">
<span id="rr-make-examples-automaticvar"></span><h4>Automatic Variables.<a class="headerlink" href="#automatic-variables" title="Permalink to this heading">#</a></h4>
<p>With automatic variables we can use the names of the
prerequisites and targets in the recipe. Here’s how we would do that for the
figure rules:</p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="c"># Makefile for analysis report</span>

<span class="nf">.PHONY</span><span class="o">:</span><span class="w"> </span><span class="n">all</span> <span class="n">clean</span>

<span class="nf">all</span><span class="o">:</span><span class="w"> </span><span class="n">output</span>/<span class="n">report</span>.<span class="n">pdf</span>

<span class="nf">output/figure_1.png</span><span class="o">:</span><span class="w"> </span><span class="n">data</span>/<span class="n">input_file_</span>1.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_histogram</span>.<span class="n">py</span>
<span class="w">	</span>python<span class="w"> </span>scripts/generate_histogram.py<span class="w"> </span>-i<span class="w"> </span>$&lt;<span class="w"> </span>-o<span class="w"> </span><span class="nv">$@</span>

<span class="nf">output/figure_2.png</span><span class="o">:</span><span class="w"> </span><span class="n">data</span>/<span class="n">input_file_</span>2.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_histogram</span>.<span class="n">py</span>
<span class="w">	</span>python<span class="w"> </span>scripts/generate_histogram.py<span class="w"> </span>-i<span class="w"> </span>$&lt;<span class="w"> </span>-o<span class="w"> </span><span class="nv">$@</span>

<span class="nf">output/report.pdf</span><span class="o">:</span><span class="w"> </span><span class="n">report</span>/<span class="n">report</span>.<span class="n">tex</span> <span class="n">output</span>/<span class="n">figure_</span>1.<span class="n">png</span> <span class="n">output</span>/<span class="n">figure_</span>2.<span class="n">png</span>
<span class="w">	</span><span class="nb">cd</span><span class="w"> </span>report/<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>pdflatex<span class="w"> </span>report.tex<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mv<span class="w"> </span>report.pdf<span class="w"> </span>../output/report.pdf

<span class="nf">clean</span><span class="o">:</span>
<span class="w">	</span>rm<span class="w"> </span>-f<span class="w"> </span>output/report.pdf
<span class="w">	</span>rm<span class="w"> </span>-f<span class="w"> </span>output/figure_*.png
</pre></div>
</div>
<p>We’ve replaced the input and output filenames in the recipes respectively by
<code class="docutils literal notranslate"><span class="pre">$&lt;</span></code>, which denotes the <em>first</em> prerequisite and <code class="docutils literal notranslate"><span class="pre">$&#64;</span></code> which denotes the
<em>target</em>. You can remember <code class="docutils literal notranslate"><span class="pre">$&lt;</span></code> because it’s like an arrow that points to
the beginning (<em>first</em> prerequisite), and you can remember <code class="docutils literal notranslate"><span class="pre">$&#64;</span></code> (dollar
<em>at</em>) <a class="reference external" href="https://jameshfisher.com/2016/12/07/makefile-automatic-variables/">as the target you’re aiming
<em>at</em></a>.</p>
<p>There are more automatic variables that you could use, see <a class="reference external" href="https://www.gnu.org/software/make/manual/html_node/Automatic-Variables.html">the
documentation</a>.</p>
</section>
<section id="pattern-rules">
<span id="rr-make-examples-patternrules"></span><h4>Pattern Rules<a class="headerlink" href="#pattern-rules" title="Permalink to this heading">#</a></h4>
<p>Notice that the recipes for the figures have become
identical!  Because we don’t like to repeat ourselves, we can combine the two
rules into a single rule by using <em>pattern rules</em>. Pattern rules allow you to
use the <code class="docutils literal notranslate"><span class="pre">%</span></code> symbol as a wildcard and combine the two rules into one:</p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="c"># Makefile for analysis report</span>

<span class="nf">.PHONY</span><span class="o">:</span><span class="w"> </span><span class="n">all</span> <span class="n">clean</span>

<span class="nf">all</span><span class="o">:</span><span class="w"> </span><span class="n">output</span>/<span class="n">report</span>.<span class="n">pdf</span>

<span class="nf">output/figure_%.png</span><span class="o">:</span><span class="w"> </span><span class="n">data</span>/<span class="n">input_file_</span>%.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_histogram</span>.<span class="n">py</span>
<span class="w">	</span>python<span class="w"> </span>scripts/generate_histogram.py<span class="w"> </span>-i<span class="w"> </span>$&lt;<span class="w"> </span>-o<span class="w"> </span><span class="nv">$@</span>

<span class="nf">output/report.pdf</span><span class="o">:</span><span class="w"> </span><span class="n">report</span>/<span class="n">report</span>.<span class="n">tex</span> <span class="n">output</span>/<span class="n">figure_</span>1.<span class="n">png</span> <span class="n">output</span>/<span class="n">figure_</span>2.<span class="n">png</span>
<span class="w">	</span><span class="nb">cd</span><span class="w"> </span>report/<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>pdflatex<span class="w"> </span>report.tex<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mv<span class="w"> </span>report.pdf<span class="w"> </span>../output/report.pdf

<span class="nf">clean</span><span class="o">:</span>
<span class="w">	</span>rm<span class="w"> </span>-f<span class="w"> </span>output/report.pdf
<span class="w">	</span>rm<span class="w"> </span>-f<span class="w"> </span>output/figure_*.png
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">%</span></code> symbol is now a wildcard that (in our case) takes the value <code class="docutils literal notranslate"><span class="pre">1</span></code> or
<code class="docutils literal notranslate"><span class="pre">2</span></code> based on the input files in the <code class="docutils literal notranslate"><span class="pre">data</span></code> directory. You can check that
everything still works by running <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">clean</span></code> followed by <code class="docutils literal notranslate"><span class="pre">make</span></code>.</p>
<p>An advantage of this is that if you now want to add another dataset, say
<code class="docutils literal notranslate"><span class="pre">input_file_3</span></code>, then you would only need to add that to the rule for the
report!</p>
</section>
</section>
<section id="makefile-no-5-wildcards-and-path-substitution">
<span id="rr-make-examples-makefile5"></span><h3>Makefile no. 5 (Wildcards and Path Substitution)<a class="headerlink" href="#makefile-no-5-wildcards-and-path-substitution" title="Permalink to this heading">#</a></h3>
<p>When Makefiles get more complex, you may want to use more advanced features
such as building outputs for all the files in an input directory. While
pattern rules will get you a long way, Make also has features for wildcards
and string or path manipulation for when pattern rules are insufficient.</p>
<p>While previously our input files were numbered, we’ll now switch to a scenario
where they have more meaningful names. Let’s switch over to the <code class="docutils literal notranslate"><span class="pre">big_data</span></code>
branch:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>checkout<span class="w"> </span>big_data<span class="w">         </span><span class="c1"># checkout the big_data branch</span>
</pre></div>
</div>
<p>The directory structure now looks like this:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>├── data/
│   ├── action.csv
│   ├── ...
│   ├── input_file_1.csv
│   ├── input_file_2.csv
│   ├── ...
│   └── western.csv
├── LICENSE
├── output/
├── README.md
├── report/
│   └── report.tex
└── scripts/
    └── generate_histogram.py
</pre></div>
</div>
<p>As you can see, the <strong>data</strong> directory now contains additional input files
that are named more meaningfully (the data are IMBD movie ratings by genre).
Also, the <strong>report.tex</strong> file has been updated to work with the expected
figures.</p>
<p>We’ll adapt our Makefile to create a figure in the output directory called
<code class="docutils literal notranslate"><span class="pre">histogram_{genre}.png</span></code> for each <code class="docutils literal notranslate"><span class="pre">{genre}.csv</span></code> file, while excluding the
<code class="docutils literal notranslate"><span class="pre">input_file_{N}.csv</span></code> files.</p>
<blockquote>
<div><p>Sidenote: if we were to remove the <code class="docutils literal notranslate"><span class="pre">input_file_{N}.csv</span></code> files, pattern
rules would be sufficient here. This highlights that sometimes your
directory structure and Makefile should be developed hand in hand.</p>
</div></blockquote>
<p>Before changing the Makefile, run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>make<span class="w"> </span>clean
</pre></div>
</div>
<p>to remove the output files.</p>
<p>We’ll show the full Makefile first, and then describe the different lines in
more detail. The complete file is:</p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="c"># Makefile for analysis report</span>
<span class="c">#</span>

<span class="nv">ALL_CSV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>wildcard<span class="w"> </span>data/*.csv<span class="k">)</span>
<span class="nv">INPUT_CSV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>wildcard<span class="w"> </span>data/input_file_*.csv<span class="k">)</span>
<span class="nv">DATA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>filter-out<span class="w"> </span><span class="k">$(</span>INPUT_CSV<span class="k">)</span>,<span class="k">$(</span>ALL_CSV<span class="k">))</span>
<span class="nv">FIGURES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>patsubst<span class="w"> </span>data/%.csv,output/figure_%.png,<span class="k">$(</span>DATA<span class="k">))</span>

<span class="nf">.PHONY</span><span class="o">:</span><span class="w"> </span><span class="n">all</span> <span class="n">clean</span>

<span class="nf">all</span><span class="o">:</span><span class="w"> </span><span class="n">output</span>/<span class="n">report</span>.<span class="n">pdf</span>

<span class="nf">$(FIGURES)</span><span class="o">:</span><span class="w"> </span><span class="n">output</span>/<span class="n">figure_</span>%.<span class="n">png</span>: <span class="n">data</span>/%.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_histogram</span>.<span class="n">py</span>
<span class="w">	</span>python<span class="w"> </span>scripts/generate_histogram.py<span class="w"> </span>-i<span class="w"> </span>$&lt;<span class="w"> </span>-o<span class="w"> </span><span class="nv">$@</span>

<span class="nf">output/report.pdf</span><span class="o">:</span><span class="w"> </span><span class="n">report</span>/<span class="n">report</span>.<span class="n">tex</span> <span class="k">$(</span><span class="nv">FIGURES</span><span class="k">)</span>
<span class="w">	</span><span class="nb">cd</span><span class="w"> </span>report/<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>pdflatex<span class="w"> </span>report.tex<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mv<span class="w"> </span>report.pdf<span class="w"> </span>../<span class="nv">$@</span>

<span class="nf">clean</span><span class="o">:</span>
<span class="w">	</span>rm<span class="w"> </span>-f<span class="w"> </span>output/report.pdf
<span class="w">	</span>rm<span class="w"> </span>-f<span class="w"> </span><span class="k">$(</span>FIGURES<span class="k">)</span>
</pre></div>
</div>
<p>First, we use the <code class="docutils literal notranslate"><span class="pre">wildcard</span></code> function to create a variable that lists all
the CSV files in the data directory and one that lists only the old
<code class="docutils literal notranslate"><span class="pre">input_file_{N}.csv</span></code> files:</p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="nv">ALL_CSV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>wildcard<span class="w"> </span>data/*.csv<span class="k">)</span>
<span class="nv">INPUT_CSV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>wildcard<span class="w"> </span>data/input_file_*.csv<span class="k">)</span>
</pre></div>
</div>
<p>A code convention for Makefiles is to use all capitals for variable names and
define them at the top of the file.</p>
<p>Next, we create a variable to list only the data files that we’re interested
in by filtering out the <code class="docutils literal notranslate"><span class="pre">INPUT_CSV</span></code> from <code class="docutils literal notranslate"><span class="pre">ALL_CSV</span></code>:</p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="nv">DATA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>filter-out<span class="w"> </span><span class="k">$(</span>INPUT_CSV<span class="k">)</span>,<span class="k">$(</span>ALL_CSV<span class="k">))</span>
</pre></div>
</div>
<p>This line uses the
<a class="reference external" href="https://www.gnu.org/software/make/manual/make.html#index-filter_002dout"><code class="docutils literal notranslate"><span class="pre">filter-out</span></code></a>
function to remove items in the <code class="docutils literal notranslate"><span class="pre">INPUT_CSV</span></code> variable from the <code class="docutils literal notranslate"><span class="pre">ALL_CSV</span></code>
variable.  Note that we use both the <code class="docutils literal notranslate"><span class="pre">$(</span> <span class="pre">...</span> <span class="pre">)</span></code> syntax for functions and
variables. Finally, we’ll use the <code class="docutils literal notranslate"><span class="pre">DATA</span></code> variable to create a <code class="docutils literal notranslate"><span class="pre">FIGURES</span></code>
variable with the desired output:</p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="nv">FIGURES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>patsubst<span class="w"> </span>data/%.csv,output/figure_%.png,<span class="k">$(</span>DATA<span class="k">))</span>
</pre></div>
</div>
<p>Here we’ve used the
<a class="reference external" href="https://www.gnu.org/software/make/manual/make.html#index-patsubst-1"><code class="docutils literal notranslate"><span class="pre">patsubst</span></code></a>
function to transform the input in the <code class="docutils literal notranslate"><span class="pre">DATA</span></code> variable (that follows the
<code class="docutils literal notranslate"><span class="pre">data/{genre}.csv</span></code> pattern) to the desired output filenames (using the
<code class="docutils literal notranslate"><span class="pre">output/figure_{genre}.png</span></code> pattern). Notice that the <code class="docutils literal notranslate"><span class="pre">%</span></code> character marks
the part of the filename that will be the same in both the input and output.</p>
<p>Now we use these variables for the figure generation rule as follows:</p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="nf">$(FIGURES)</span><span class="o">:</span><span class="w"> </span><span class="n">output</span>/<span class="n">figure_</span>%.<span class="n">png</span>: <span class="n">data</span>/%.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_histogram</span>.<span class="n">py</span>
<span class="w">	</span>python<span class="w"> </span>scripts/generate_histogram.py<span class="w"> </span>-i<span class="w"> </span>$&lt;<span class="w"> </span>-o<span class="w"> </span><span class="nv">$@</span>
</pre></div>
</div>
<p>This rule again applies a pattern: it takes a list of targets (<code class="docutils literal notranslate"><span class="pre">$(FIGURES)</span></code>)
that all follow a given pattern (<code class="docutils literal notranslate"><span class="pre">output/figure_%.png</span></code>) and based on that
creates a prerequisite (<code class="docutils literal notranslate"><span class="pre">data/%.csv</span></code>). Such a pattern rule is slightly
different from the one we saw before because it uses two <code class="docutils literal notranslate"><span class="pre">:</span></code> symbols. It is
called a <a class="reference external" href="https://www.gnu.org/software/make/manual/make.html#Static-Pattern">static pattern
rule</a>.</p>
<p>Of course we have to update the <code class="docutils literal notranslate"><span class="pre">report.pdf</span></code> rule as well:</p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="nf">output/report.pdf</span><span class="o">:</span><span class="w"> </span><span class="n">report</span>/<span class="n">report</span>.<span class="n">tex</span> <span class="k">$(</span><span class="nv">FIGURES</span><span class="k">)</span>
<span class="w">	</span><span class="nb">cd</span><span class="w"> </span>report/<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>pdflatex<span class="w"> </span>report.tex<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mv<span class="w"> </span>report.pdf<span class="w"> </span>../<span class="nv">$@</span>
</pre></div>
</div>
<p>and the <code class="docutils literal notranslate"><span class="pre">clean</span></code> rule:</p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="nf">clean</span><span class="o">:</span>
<span class="w">	</span>rm<span class="w"> </span>-f<span class="w"> </span>output/report.pdf
<span class="w">	</span>rm<span class="w"> </span>-f<span class="w"> </span><span class="k">$(</span>FIGURES<span class="k">)</span>
</pre></div>
</div>
<p>If you run this Makefile, it will need to build 28 figures. You may want to
use the <code class="docutils literal notranslate"><span class="pre">-j</span></code> flag to <code class="docutils literal notranslate"><span class="pre">make</span></code> to build these targets <strong>in parallel!</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>make<span class="w"> </span>-j<span class="w"> </span><span class="m">4</span>
</pre></div>
</div>
<p>The ability to build targets in parallel is quite useful when your project has
many dependencies!</p>
<p>The resulting PDF file should now look like this:</p>
<p><img alt="Report with all genres" src="figures/make-report-all-genres.png" /><small
style="margin: 5pt auto; text-align: center; display: block;">A compressed
view of the report with histograms for all genres.</small></p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./reproducible-research/make"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#makefiles">Makefiles</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up">Setting up</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#makefile-no-1-the-basics">Makefile no. 1 (The Basics)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#makefile-no-2-all-and-clean">Makefile no. 2 (all and clean)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#makefile-no-3-phony-targets">Makefile no. 3 (Phony Targets)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#makefile-no-4-automatic-variables-and-pattern-rules">Makefile no. 4 (Automatic Variables and Pattern Rules)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#automatic-variables">Automatic Variables.</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pattern-rules">Pattern Rules</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#makefile-no-5-wildcards-and-path-substitution">Makefile no. 5 (Wildcards and Path Substitution)</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Dionysus
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  The Artist is the creator of beautiful things

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>